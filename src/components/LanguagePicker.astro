---
import { languages } from '../i18n/dictionary.ts';
import { getLangFromURL, useTranslations, getPagePath } from '../i18n/util.ts';

const languageSelected = getLangFromURL(Astro.url);
const { activeSection } = Astro.props;


function getActiveSectionName(languageSelected: string): string {
  let activeSectionName:string;
  const dictionarySections = useTranslations(languageSelected);

  switch (activeSection) {
    case '0':
      activeSectionName = normalizeSection(dictionarySections('navbar.home'));
      break;
    case '1':
      activeSectionName = normalizeSection(dictionarySections('navbar.education'));
      break;
    case '2':
      activeSectionName = normalizeSection(dictionarySections('navbar.projects'));
      break;
    case '4':
      activeSectionName = normalizeSection(dictionarySections('navbar.contact'));
  }

  return activeSectionName;
}

function normalizeSection(section: string): string {
  return section;
}
---
<style>
  nav {
    display: flex;
    padding: 5px;
    justify-content: center;
    column-gap: 10px;

    background-color: var(--primary-color);
    border: 2px solid var(--secondary-color);
    border-radius: 4px;

    & a {
      height: 20px;

      border: 2px solid var(--secondary-color);
      border-radius: 5px;
      background-color: transparent;
      cursor: pointer;

      & .flag {
        height: 20px;
        border-radius: 5px;
        opacity: .3;
      }

      & .flag.active {
        opacity: 1;
      }
    }
  }
</style>
<nav id='language-picker'>
  {Object.entries(languages).map(([lang,]) => (
    <a href={getPagePath(lang, getActiveSectionName(lang))}><img class={`flag${lang === languageSelected ? ' active' : ''}`} src={`/images/flags/${lang}.svg`} /></a>
  ))}
</nav>
<script>
  const buttonFlags = document.querySelectorAll('#language-picker > button');
  buttonFlags.forEach((buttonFlag) => buttonFlag.addEventListener('click', () => {
    restoreFlagsClassLists();
    buttonFlag.querySelector('.flag').classList.add('active');
  }));

  function restoreFlagsClassLists() {
    const flags = document.querySelectorAll('#language-picker > button > .flag');
    flags.forEach((flag) => flag.classList.remove('active'));
  }
</script>